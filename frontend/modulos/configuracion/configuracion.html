<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AXYRA - Configuración</title>
    <link rel="stylesheet" href="../../static/axyra-styles.css">
    <link rel="stylesheet" href="../../static/advanced-features.css">
    <link rel="stylesheet" href="../../static/2fa-styles.css">
    <link rel="stylesheet" href="../../static/responsive-styles.css">
    <link rel="stylesheet" href="../../static/modal-fixes.css">
    <link rel="stylesheet" href="config-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
        import { getFirestore, doc, getDoc, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';
        
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBvQvqQvqQvqQvqQvqQvqQvqQvqQvqQvqQ",
            authDomain: "villa-venecia-nomina.firebaseapp.com",
            projectId: "villa-venecia-nomina",
            storageBucket: "villa-venecia-nomina.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Global auth state
        window.axyraAuth = { auth, db };
        
        // Check auth state
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log('Usuario autenticado:', user.email);
                // Initialize configuration
                if (window.axyraConfig) {
                    window.axyraConfig.init();
                }
            } else {
                console.log('Usuario no autenticado');
                window.location.href = '../../login.html';
            }
        });
    </script>
</head>
<body>
    <!-- Header -->
    <header class="axyra-header">
        <div class="axyra-header-content">
            <div class="axyra-logo-section">
                <div class="axyra-logo-title">
                    <i class="fas fa-chart-line"></i>
                    <span>AXYRA</span>
                    <div class="axyra-role-badge" id="roleBadge">
                        <i class="fas fa-user"></i>
                        <span class="axyra-role-badge-text">Empleado</span>
                    </div>
                </div>
                <div class="axyra-logo-subtitle" id="pageSubtitle">Configuración</div>
            </div>
            
            <!-- Navigation Buttons -->
            <div class="axyra-nav-buttons">
                <a href="../dashboard/dashboard.html" class="axyra-nav-btn" title="Dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="../empleados/empleados.html" class="axyra-nav-btn" title="Empleados">
                    <i class="fas fa-users"></i>
                    <span>Empleados</span>
                </a>
                <a href="../horas/horas.html" class="axyra-nav-btn" title="Horas">
                    <i class="fas fa-clock"></i>
                    <span>Horas</span>
                </a>
                <a href="../nomina/nomina.html" class="axyra-nav-btn" title="Nómina">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Nómina</span>
                </a>
                <a href="../cuadre_caja/cuadre_caja.html" class="axyra-nav-btn" title="Cuadre de Caja">
                    <i class="fas fa-cash-register"></i>
                    <span>Caja</span>
                </a>
                <a href="../inventario/inventario.html" class="axyra-nav-btn" title="Inventario">
                    <i class="fas fa-boxes"></i>
                    <span>Inventario</span>
                </a>
            </div>
            
            <div class="axyra-header-actions">
                <div class="axyra-notifications-icon" id="notificationsIcon">
                    <i class="fas fa-bell"></i>
                    <span class="axyra-notification-badge" id="notificationBadge">0</span>
                </div>
                <div class="axyra-user-menu" id="userMenu">
                    <i class="fas fa-user-circle"></i>
                    <span id="userEmail">Usuario</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="axyra-main-content">
        <div class="axyra-config-container">
            <h1 class="axyra-config-title">Configuración del Sistema</h1>
            <p class="axyra-config-subtitle">Gestiona la configuración de tu empresa y la seguridad del sistema</p>

            <!-- Seguridad y Configuración -->
            <div class="axyra-security-section">
                <h2 class="axyra-section-title">Seguridad y Configuración</h2>
                <div class="axyra-security-grid">
                    <!-- 2FA Status -->
                    <div class="axyra-security-item">
                        <div class="axyra-security-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="axyra-security-content">
                            <h4>Autenticación de Dos Factores (2FA)</h4>
                            <p>Protege tu cuenta con una capa adicional de seguridad</p>
                            <div class="axyra-2fa-status" id="2faStatus">
                                <span class="axyra-2fa-label">Estado:</span>
                                <span class="axyra-2fa-value" id="2faStatusValue">No configurado</span>
                            </div>
                            <div class="axyra-security-actions">
                                <button class="axyra-btn axyra-btn-primary" onclick="setup2FA()">
                                    <i class="fas fa-cog"></i> Configurar 2FA
                                </button>
                                <button class="axyra-btn axyra-btn-secondary" onclick="test2FA()">
                                    <i class="fas fa-test-tube"></i> Probar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Session Timeout -->
                    <div class="axyra-security-item">
                        <div class="axyra-security-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="axyra-security-content">
                            <h4>Timeout de Sesión</h4>
                            <p>Configura el tiempo de inactividad antes del cierre automático</p>
                            <div class="axyra-session-info" id="sessionInfo">
                                <span class="axyra-session-label">Tiempo restante:</span>
                                <span class="axyra-session-time" id="sessionTime">--:--</span>
                            </div>
                            <div class="axyra-security-actions">
                                <button class="axyra-btn axyra-btn-primary" onclick="resetSessionTimeout()">
                                    <i class="fas fa-refresh"></i> Renovar Sesión
                                </button>
                                <button class="axyra-btn axyra-btn-secondary" onclick="configureSessionTimeout()">
                                    <i class="fas fa-cog"></i> Configurar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Responsive Design -->
                    <div class="axyra-security-item">
                        <div class="axyra-security-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <div class="axyra-security-content">
                            <h4>Diseño Responsivo</h4>
                            <p>Estado del sistema de adaptación a diferentes dispositivos</p>
                            <div class="axyra-responsive-info" id="responsiveInfo">
                                <span class="axyra-responsive-label">Estado:</span>
                                <span class="axyra-responsive-status" id="responsiveStatus">Activo</span>
                            </div>
                            <div class="axyra-security-actions">
                                <button class="axyra-btn axyra-btn-primary" onclick="testResponsive()">
                                    <i class="fas fa-eye"></i> Probar Responsive
                                </button>
                                <button class="axyra-btn axyra-btn-secondary" onclick="configureResponsive()">
                                    <i class="fas fa-cog"></i> Configurar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Backup System -->
                    <div class="axyra-security-item">
                        <div class="axyra-security-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="axyra-security-content">
                            <h4>Sistema de Respaldo</h4>
                            <p>Gestiona respaldos automáticos y manuales del sistema</p>
                            <div class="axyra-backup-info" id="backupInfo">
                                <span class="axyra-backup-label">Último respaldo:</span>
                                <span class="axyra-backup-date" id="lastBackupDate">Nunca</span>
                            </div>
                            <div class="axyra-security-actions">
                                <button class="axyra-btn axyra-btn-primary" onclick="performBackup()">
                                    <i class="fas fa-download"></i> Realizar Respaldo
                                </button>
                                <button class="axyra-btn axyra-btn-secondary" onclick="configureBackup()">
                                    <i class="fas fa-cog"></i> Configurar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications -->
                    <div class="axyra-security-item">
                        <div class="axyra-security-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="axyra-security-content">
                            <h4>Sistema de Notificaciones</h4>
                            <p>Configura las notificaciones del sistema y su frecuencia</p>
                            <div class="axyra-notifications-info" id="notificationsInfo">
                                <span class="axyra-notifications-label">Frecuencia:</span>
                                <span class="axyra-notifications-frequency" id="notificationsFrequency">Cada 10 min</span>
                            </div>
                            <div class="axyra-security-actions">
                                <button class="axyra-btn axyra-btn-primary" onclick="testNotifications()">
                                    <i class="fas fa-bell"></i> Probar Notificación
                                </button>
                                <button class="axyra-btn axyra-btn-secondary" onclick="configureNotifications()">
                                    <i class="fas fa-cog"></i> Configurar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- System Updates -->
                    <div class="axyra-security-item">
                        <div class="axyra-security-icon">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="axyra-security-content">
                            <h4>Actualizaciones del Sistema</h4>
                            <p>Verifica y gestiona las actualizaciones disponibles</p>
                            <div class="axyra-updates-info" id="updatesInfo">
                                <span class="axyra-updates-label">Versión actual:</span>
                                <span class="axyra-updates-version" id="currentVersion">1.0.0</span>
                            </div>
                            <div class="axyra-security-actions">
                                <button class="axyra-btn axyra-btn-primary" onclick="checkUpdates()">
                                    <i class="fas fa-search"></i> Verificar Actualizaciones
                                </button>
                                <button class="axyra-btn axyra-btn-secondary" onclick="configureUpdates()">
                                    <i class="fas fa-cog"></i> Configurar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuración de Empresa -->
            <div class="axyra-company-section">
                <h2 class="axyra-section-title">Configuración de Empresa</h2>
                <div class="axyra-company-form">
                    <div class="axyra-form-group">
                        <label for="companyName">Nombre de la Empresa</label>
                        <input type="text" id="companyName" class="axyra-form-input" placeholder="Ingresa el nombre de tu empresa">
                    </div>
                    <div class="axyra-form-group">
                        <label for="companyNIT">NIT</label>
                        <input type="text" id="companyNIT" class="axyra-form-input" placeholder="Ingresa el NIT de la empresa">
                    </div>
                    <div class="axyra-form-group">
                        <label for="companyAddress">Dirección</label>
                        <input type="text" id="companyAddress" class="axyra-form-input" placeholder="Ingresa la dirección de la empresa">
                    </div>
                    <div class="axyra-form-group">
                        <label for="companyPhone">Teléfono</label>
                        <input type="tel" id="companyPhone" class="axyra-form-input" placeholder="Ingresa el teléfono de la empresa">
                    </div>
                    <div class="axyra-form-group">
                        <label for="companyEmail">Email</label>
                        <input type="email" id="companyEmail" class="axyra-form-input" placeholder="Ingresa el email de la empresa">
                    </div>
                    <div class="axyra-form-actions">
                        <button class="axyra-btn axyra-btn-primary" onclick="saveCompanyConfig()">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                        <button class="axyra-btn axyra-btn-secondary" onclick="resetCompanyConfig()">
                            <i class="fas fa-undo"></i> Restaurar Valores
                        </button>
                    </div>
                </div>
            </div>

            <!-- Configuración del Sistema -->
            <div class="axyra-system-section">
                <h2 class="axyra-section-title">Configuración del Sistema</h2>
                <div class="axyra-system-options">
                    <div class="axyra-option-group">
                        <h4>Preferencias Generales</h4>
                        <div class="axyra-option-item">
                            <label class="axyra-switch">
                                <input type="checkbox" id="autoSave" checked>
                                <span class="axyra-slider"></span>
                            </label>
                            <span class="axyra-option-label">Guardado automático</span>
                        </div>
                        <div class="axyra-option-item">
                            <label class="axyra-switch">
                                <input type="checkbox" id="darkMode">
                                <span class="axyra-slider"></span>
                            </label>
                            <span class="axyra-option-label">Modo oscuro</span>
                        </div>
                        <div class="axyra-option-item">
                            <label class="axyra-switch">
                                <input type="checkbox" id="notifications" checked>
                                <span class="axyra-slider"></span>
                            </label>
                            <span class="axyra-option-label">Notificaciones push</span>
                        </div>
                    </div>
                    
                    <div class="axyra-option-group">
                        <h4>Configuración de Sesión</h4>
                        <div class="axyra-option-item">
                            <label for="sessionTimeout">Timeout de sesión (minutos)</label>
                            <select id="sessionTimeout" class="axyra-form-select">
                                <option value="15">15 minutos</option>
                                <option value="30" selected>30 minutos</option>
                                <option value="60">1 hora</option>
                                <option value="120">2 horas</option>
                            </select>
                        </div>
                        <div class="axyra-option-item">
                            <label for="maxLoginAttempts">Intentos máximos de login</label>
                            <select id="maxLoginAttempts" class="axyra-form-select">
                                <option value="3">3 intentos</option>
                                <option value="5" selected>5 intentos</option>
                                <option value="10">10 intentos</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="../../static/roles-config.js"></script>
    <script src="../../static/notifications-system.js"></script>
    <script src="../../static/session-timeout.js"></script>
    <script src="../../static/2fa-system.js"></script>
    <script src="../../static/backup-system.js"></script>
    <script src="config.js"></script>
</body>
</html>
